created: 20250316124433903
modified: 20250317081611188
modifier: uzvg
tags: PermanentNotes zsh Shell
title: zsh shell parameter expansion
type: text/vnd.tiddlywiki

!! 1. 基本概念

* 参数展开的基本语法 `${name}`
* zsh与其他shell的主要区别（如SH\_WORD\_SPLIT选项）
* 空值和null值的处理方式
* 引用和未引用参数的行为差异

👉 [[zsh shell parameter expansion basics]]

!! 2. 基本参数展开形式

* 基本语法：`${name}`
* 判断参数是否存在：`${+name}`
* 默认值设置：`${name-word}` 和 `${name:-word}`
* 替代值设置：`${name+word}` 和 `${name:+word}`
* 参数赋值：`${name=word}`、`${name:=word}` 和 `${name::=word}`
* 错误检查：`${name?word}` 和 `${name:?word}`

!! 3. 模式匹配与替换

* 前缀匹配删除：`${name#pattern}` 和 `${name##pattern}`
* 后缀匹配删除：`${name%pattern}` 和 `${name%%pattern}`
* 完全匹配测试：`${name:#pattern}`
* 字符串替换：`${name/pattern/repl}`、`${name//pattern/repl}` 和 `${name:/pattern/repl}`
* 数组操作：`${name:|arrayname}`、`${name:*arrayname}`、`${name:^arrayname}` 和 `${name:^^arrayname}`

!! 4. 特殊参数展开

* 获取参数长度：`${#name}`
* 索引和子字符串：`${name:offset}` 和 `${name:offset:length}`
* 参数数组扩展：`${^name}` 和 `${^^name}`
* 单词分割：`${=name}` 和 `${==name}`
* 模式匹配：`${~name}` 和 `${~~name}`

!! 5. 参数展开标志

* 标志的语法：`${(flags)name}`
* 数值标志：`#`（字符编码）
* 提示展开：`%`（提示字符串扩展）
* 数组标志：`@`（数组元素分离）、`A`（数组转换）、`a`（数组索引排序）
* 引用标志：`b`（反斜杠转义）、`q`（引用特殊字符）、`Q`（移除引用）
* 计数标志：`c`（计算字符总数）、`w`（计算单词数）、`W`（计算空单词）
* 转换标志：`C`（首字母大写）、`L`（小写）、`U`（大写）
* 路径标志：`D`（目录名替换）
* 扩展标志：`e`（进行shell扩展）
* 分割标志：`f`（按行分割）、`s:string:`（指定分隔符分割）、`z`（shell解析分割）、`0`（按null字节分割）
* 连接标志：`F`（按行连接）、`j:string:`（指定分隔符连接）
* 排序标志：`i`（忽略大小写排序）、`n`（数字排序）、`-`（带负号的数字排序）、`o`（升序排序）、`O`（降序排序）
* 参数名标志：`P`（将值解释为参数名）
* 唯一标志：`u`（移除重复元素）
* 可见性标志：`V`（使特殊字符可见）

!! 6. 字符串处理标志

* 转义序列处理：`g:opts:`
* 字符串填充：`l:expr::string1::string2:`（左填充）、`r:expr::string1::string2:`（右填充）
* 多字节字符支持：`m`（多字节字符宽度）

!! 7. 模式匹配标志

* 子字符串匹配：`S`（搜索最接近的匹配）
* 匹配索引：`I:expr:`（搜索第expr个匹配）
* 扩展通配符：`*`（启用EXTENDED\_GLOB）
* 匹配信息：`B`（包含匹配开始位置）、`E`（包含匹配结束位置）、`M`（包含匹配部分）、`N`（包含匹配长度）、`R`（包含未匹配部分）

!! 8. 参数展开规则

* 嵌套替换的处理顺序
* 参数标志的应用顺序
* 下标的处理
* 字符串操作的应用顺序
* 数组操作的应用顺序
* 单词分割和连接的规则

!! 9. 高级应用示例

* 文件内容处理
* 嵌套参数展开
* 单词分割和连接的复杂示例
* 数组操作的实用场景

这个大纲涵盖了zsh参数展开的全部核心概念，从基础到高级，按照学习的逻辑顺序组织。每个主题都包含了相关的语法和选项，方便系统性学习。
