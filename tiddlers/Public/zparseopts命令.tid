created: 20250305013520222
description: ä½¿ç”¨zparseoptsä¸ºzsh Shellå‘½ä»¤è§£æé€‰é¡¹åŠå…¶å‚æ•°
modified: 20250317090326801
modifier: uzvg
progress: Completed
rating: Promising
tags: PermanentNotes zsh Shell
title: zparseoptså‘½ä»¤
type: text/vnd.tiddlywiki
visibility: Public

!! å¼•è¨€ï¼š

å†™zshå‡½æ•°æ—¶è¦å¤„ç†é€‰é¡¹åŠå…¶å¯¹åº”çš„å‚æ•°ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°`zparseopts`ï¼Œå®ƒæ˜¯zsh Shellçš„å†…ç½®çš„åŠŸèƒ½ï¼Œå…·ä½“æ–‡æ¡£å¯ä»¥é€šè¿‡`man zmodules`ï¼Œæœç´¢`zparseopts`æ¥æŸ¥çœ‹ï¼Œå®ƒå¸¸è¢«ç”¨äºå¤„ç†å‡½æ•°çš„é€‰é¡¹åŠå…¶é€‰é¡¹å¯¹åº”çš„å‚æ•°ã€‚

!! å‘½ä»¤æ ¼å¼ï¼š

```zsh
zparseopts [ -D -E -F -K -M ] [ -a array ] [ -A assoc ] [ - ] spec ...
```

* å…¶ä¸­ï¼Œ`[-]`ä¹‹å‰çš„ï¼Œæ˜¯`zparseopts`è‡ªèº«çš„é€‰é¡¹å‚æ•°ï¼Œè€Œ`[-]`ä¹‹åçš„`spec`æ˜¯å¯¹åº”çš„å‡½æ•°çš„é€‰é¡¹è§„æ ¼ã€‚
* Each spec describes one option and must be of the form â€˜opt[=array]'.  If an option described by  opt  is found  in  the positional parameters it is copied into the array specified with the `-a` option;
* if the optional â€˜=array' is given, it is instead copied into that array, which should be declared as a normal array and  never as an associative array.

!! å®é™…åº”ç”¨ï¼š

`zparseopts`çš„æ–‡æ¡£å†™å¾—ä¸ç”šè¯¦ç»†ï¼Œå¾ˆå¤šåŠŸèƒ½ä¸å¸¸ç”¨åˆ°ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›åœ¨å®é™…åº”ç”¨ä¸­èƒ½ç”¨åˆ°çš„çŸ¥è¯†ï¼Œæœ‰å¦‚ä¸‹è„šæœ¬ï¼š

```
#!/bin/zsh
zparseopts -D -E -- -output:=output -user:=user -verbose=verbose -help=help o:=output v=verbose h=help

[[ -n $output ]] && echo "Output: $output[2]"
[[ -n $user ]] && echo "user: $user"
[[ -n $verbose ]] && echo "verbose: Verbose mode ON"
[[ -n $help ]] && echo "help: show help message"

echo "Other args: $@"
```

* `--`ç”¨æ¥åˆ†éš”é€‰é¡¹å‚æ•°å’Œä½ç½®å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨`--`ä¹‹åçš„ï¼Œå±äº`zparseopts`çš„ä½ç½®å‚æ•°ï¼Œè€Œä½ç½®å‚æ•°æœ¬èº«çš„è§„æ ¼ï¼Œåˆ™å†³å®šäº†`zparseopts`æœ¬èº«æ‰€å¤„çš„å‘½ä»¤ã€å‡½æ•°çš„é€‰é¡¹è§„æ ¼ã€‚
* `é•¿å‘½ä»¤é€‰é¡¹`åœ¨å‰é¢åŠ `-`ï¼Œ`çŸ­å‘½ä»¤`ä¸ç”¨ã€‚
* å¦‚æœå‚æ•°è¦å–å€¼ï¼Œåˆ™ä½¿ç”¨`:=`ï¼Œå¦‚æœä¸å–å€¼ï¼Œåˆ™ç”¨`=`ã€‚
* ä½¿ç”¨`-D`é€‰é¡¹ï¼Œä¼šå°†è§£ææˆåŠŸçš„å‚æ•°ï¼Œä»`${@}`ä¸­åˆ é™¤ã€‚

å°†å…¶ä¿å­˜ä¸ºä¸€ä¸ªè„šæœ¬`demo.zsh`ï¼Œå¹¶æ‰§è¡Œï¼š

```zsh
# å…¨éƒ¨ä½¿ç”¨é•¿å‘½åå‚æ•°ï¼š
$ ./demo.zsh --output test_file.txt --verbose --help
Output: test_file.txt
verbose: Verbose mode ON
help: show help message
Other args: 

# é•¿å‘½åå‚æ•°è·ŸçŸ­å‘½åå‚æ•°æ··åˆä½¿ç”¨ï¼š
$ ./demo.zsh -o test_file.txt --verbose --help
Output: -o test_file.txt
verbose: Verbose mode ON
help: show help message
Other args: 

# å…¨éƒ¨ä½¿ç”¨çŸ­å‘½åå‚æ•°ï¼š
$  ./demo.zsh -o test_file.txt -v -h
Output: test_file.txt
verbose: Verbose mode ON
help: show help message
Other args: 

# çŸ­å‘½åå‚æ•°è¿èµ·æ¥ï¼š
$ ./demo.zsh -o test_file.txt -vh
Output: test_file.txt
verbose: Verbose mode ON
help: show help message
Other args: 

# ä¼ é€’é”™è¯¯å‚æ•°ï¼š
$ ./demo.zsh -o test_file.txt -vh nonsense argument
Output: test_file.txt
verbose: Verbose mode ON
help: show help message
Other args: nonsense argument
```

!! è¡¥å……ï¼š

* ğŸ‘‰ [[æ›´å¤šzparseoptsä½¿ç”¨ç¤ºä¾‹|https://gist.github.com/mattmc3/804a8111c4feba7d95b6d7b984f12a53]]
* ğŸ‘‰ [[redditè®ºå›è¡¥å……|https://www.reddit.com/r/zsh/comments/s09vot/using_zparseopts/?rdt=49099]]
